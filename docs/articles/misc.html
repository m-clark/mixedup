<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miscellaneous Functions • mixedup</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Miscellaneous Functions">
<meta property="og:description" content="mixedup">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mixedup</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/variance_components.html">Variance Components</a>
    </li>
    <li>
      <a href="../articles/random_effects.html">Random Effects</a>
    </li>
    <li>
      <a href="../articles/fixed_effects.html">Fixed Effects</a>
    </li>
    <li>
      <a href="../articles/random_coefficients.html">Random Coefficients</a>
    </li>
    <li>
      <a href="../articles/summarize_model.html">Summarize Model</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/m-clark">
    <span class="fa fa-github-alt"></span>
     
  </a>
</li>
<li>
  <a href="https://m-clark.github.io">
    <span class="fa fa-empire"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="misc_files/header-attrs-2.3/header-attrs.js"></script><script src="misc_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Miscellaneous Functions</h1>
                        <h4 class="author">Michael Clark</h4>
            
            <h4 class="date"><span style="font-style:normal;font-family:'Open Sans'">2020-10-20</span></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/m-clark/mixedup/blob/master/vignettes/misc.Rmd"><code>vignettes/misc.Rmd</code></a></small>
      <div class="hidden name"><code>misc.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>Miscellaneous functions are included to fill a need.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="find-typical-values" class="section level3">
<h3 class="hasAnchor">
<a href="#find-typical-values" class="anchor"></a>Find typical values</h3>
<p>In many cases, predictions are made by holding the random effects to zero, which can be seen as the typical case. When the clusters carry substantive meaning, for example, school, country, or hospital, it might be of interest to note which are most ‘typical’, or at any other value relative to their peers. This will work for any model to which <code>extract_random_effects</code> applies.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(lme4)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>lmer_model &lt;-<span class="st"> </span><span class="kw">lmer</span>(Reaction <span class="op">~</span><span class="st"> </span>Days <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Days <span class="op">|</span><span class="st"> </span>Subject), <span class="dt">data =</span> sleepstudy)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(mixedup)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">find_typical</span>(lmer_model)  <span class="co"># closest RE to zero</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># A tibble: 2 x 7</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  group_var effect    group  value    se lower_<span class="fl">2.5</span> upper_<span class="fl">97.5</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>fct<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="dv">1</span> Subject   Days      <span class="dv">333</span>   <span class="fl">-0.224</span>  <span class="fl">2.31</span>     <span class="fl">-4.74</span>       <span class="fl">4.29</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="dv">2</span> Subject   Intercept <span class="dv">335</span>   <span class="fl">-0.334</span> <span class="fl">12.1</span>     <span class="fl">-24.0</span>       <span class="fl">23.3</span> </span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">find_typical</span>(lmer_model, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.9</span>))</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># A tibble: 4 x 8</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>  group_var effect    group  value    se lower_<span class="fl">2.5</span> upper_<span class="fl">97.5</span> probs</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>fct<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="dv">1</span> Subject   Days      <span class="dv">310</span>    <span class="fl">-5.45</span>  <span class="fl">2.31</span>     <span class="fl">-9.97</span>     <span class="fl">-0.931</span> <span class="dv">10</span>%  </span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="dv">2</span> Subject   Days      <span class="dv">350</span>     <span class="fl">6.61</span>  <span class="fl">2.31</span>      <span class="fl">2.10</span>     <span class="fl">11.1</span>   <span class="dv">90</span>%  </span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="dv">3</span> Subject   Intercept <span class="dv">370</span>   <span class="fl">-25.6</span>  <span class="fl">12.1</span>     <span class="fl">-49.3</span>      <span class="fl">-1.96</span>  <span class="dv">10</span>%  </span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="dv">4</span> Subject   Intercept <span class="dv">331</span>    <span class="fl">22.3</span>  <span class="fl">12.1</span>      <span class="fl">-1.40</span>     <span class="fl">45.9</span>   <span class="dv">90</span>%  </span></code></pre></div>
</div>
<div id="extract-heterogeneous-variances" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-heterogeneous-variances" class="anchor"></a>Extract heterogeneous variances</h3>
<p>For <code>nlme</code>, only models with <code>varIdent</code> have been tested. For <span class="pack" style="">glmmTMB</span>, this applies to models that use the <span class="func" style="">diag</span> function in the formula.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(nlme)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>lme_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lme</span>(</span>
<span id="cb2-4"><a href="#cb2-4"></a>  distance <span class="op">~</span><span class="st"> </span><span class="kw">scale</span>(age) <span class="op">+</span><span class="st"> </span>Sex,</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="dt">data =</span> Orthodont,</span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Subject,</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">weights =</span> <span class="kw">varIdent</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Sex)</span>
<span id="cb2-8"><a href="#cb2-8"></a>)</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="kw">extract_het_var</span>(lme_<span class="dv">1</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a>   Male Female</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="dv">1</span> <span class="fl">3.104</span>   <span class="fl">0.64</span></span></code></pre></div>
<p>May include <span class="pack" style="">brms</span> at some point, but for these, you can extract any parameters associated with sigma model for distributional models using the <code>component</code> argument of the other standard functions.</p>
</div>
<div id="extract-correlation-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-correlation-structure" class="anchor"></a>Extract correlation structure</h3>
<p>With some packages one can estimate the residual correlation structure. Right now this works for <span class="pack" style="">nlme</span>, <span class="pack" style="">glmmTMB</span>, and <span class="pack" style="">brms</span> objects.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>base_model &lt;-</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw">lme</span>(Reaction <span class="op">~</span><span class="st"> </span>Days,</span>
<span id="cb3-3"><a href="#cb3-3"></a>      <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Days <span class="op">|</span><span class="st"> </span>Subject,</span>
<span id="cb3-4"><a href="#cb3-4"></a>      <span class="dt">data =</span> sleepstudy)</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>lme_corSymm &lt;-</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="st">  </span><span class="kw">update</span>(</span>
<span id="cb3-8"><a href="#cb3-8"></a>    base_model,</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="dt">corr =</span> <span class="kw">corSymm</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Subject),</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="dt">data =</span> dplyr<span class="op">::</span><span class="kw">filter</span>(sleepstudy, Days <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a>lme_corAR &lt;-</span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="st">  </span><span class="kw">update</span>(</span>
<span id="cb3-15"><a href="#cb3-15"></a>    base_model,</span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="dt">corr =</span> <span class="kw">corAR1</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span>Days),</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="dt">data =</span> dplyr<span class="op">::</span><span class="kw">filter</span>(sleepstudy, Days <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb3-18"><a href="#cb3-18"></a>  )</span>
<span id="cb3-19"><a href="#cb3-19"></a></span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="kw">extract_cor_structure</span>(lme_corSymm)</span>
<span id="cb3-22"><a href="#cb3-22"></a>       V1    V2     V3     V4     V5</span>
<span id="cb3-23"><a href="#cb3-23"></a>V1  <span class="fl">1.000</span> <span class="fl">0.263</span> <span class="fl">-0.460</span> <span class="fl">-0.222</span> <span class="fl">-0.092</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>V2  <span class="fl">0.263</span> <span class="fl">1.000</span>  <span class="fl">0.272</span>  <span class="fl">0.356</span>  <span class="fl">0.081</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>V3 <span class="fl">-0.460</span> <span class="fl">0.272</span>  <span class="fl">1.000</span>  <span class="fl">0.377</span> <span class="fl">-0.417</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>V4 <span class="fl">-0.222</span> <span class="fl">0.356</span>  <span class="fl">0.377</span>  <span class="fl">1.000</span>  <span class="fl">0.572</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>V5 <span class="fl">-0.092</span> <span class="fl">0.081</span> <span class="fl">-0.417</span>  <span class="fl">0.572</span>  <span class="fl">1.000</span></span>
<span id="cb3-28"><a href="#cb3-28"></a></span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="kw">extract_cor_structure</span>(lme_corAR)</span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co"># A tibble: 1 x 1</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>    Phi</span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="op">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="dv">1</span> <span class="fl">0.662</span></span></code></pre></div>
</div>
<div id="extract-model-data" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-model-data" class="anchor"></a>Extract model data</h3>
<p>Just a wrapper for <code>model.frame</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">extract_model_data</span>(lmer_model)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># A tibble: 180 x 3</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>   Reaction  Days Subject</span>
<span id="cb4-4"><a href="#cb4-4"></a>      <span class="op">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>fct<span class="op">&gt;</span><span class="st">  </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="st"> </span><span class="dv">1</span>     <span class="fl">250.</span>     <span class="dv">0</span> <span class="dv">308</span>    </span>
<span id="cb4-6"><a href="#cb4-6"></a> <span class="dv">2</span>     <span class="fl">259.</span>     <span class="dv">1</span> <span class="dv">308</span>    </span>
<span id="cb4-7"><a href="#cb4-7"></a> <span class="dv">3</span>     <span class="fl">251.</span>     <span class="dv">2</span> <span class="dv">308</span>    </span>
<span id="cb4-8"><a href="#cb4-8"></a> <span class="dv">4</span>     <span class="fl">321.</span>     <span class="dv">3</span> <span class="dv">308</span>    </span>
<span id="cb4-9"><a href="#cb4-9"></a> <span class="dv">5</span>     <span class="fl">357.</span>     <span class="dv">4</span> <span class="dv">308</span>    </span>
<span id="cb4-10"><a href="#cb4-10"></a> <span class="dv">6</span>     <span class="fl">415.</span>     <span class="dv">5</span> <span class="dv">308</span>    </span>
<span id="cb4-11"><a href="#cb4-11"></a> <span class="dv">7</span>     <span class="fl">382.</span>     <span class="dv">6</span> <span class="dv">308</span>    </span>
<span id="cb4-12"><a href="#cb4-12"></a> <span class="dv">8</span>     <span class="fl">290.</span>     <span class="dv">7</span> <span class="dv">308</span>    </span>
<span id="cb4-13"><a href="#cb4-13"></a> <span class="dv">9</span>     <span class="fl">431.</span>     <span class="dv">8</span> <span class="dv">308</span>    </span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="dv">10</span>     <span class="fl">466.</span>     <span class="dv">9</span> <span class="dv">308</span>    </span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co"># … with 170 more rows</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://m-clark.github.io"><img src="man/figures/mc_logo.png" width="10%" style="display:inline"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
