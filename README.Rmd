---
output: 
  github_document:
    toc: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = NA,
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# mixedup

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/m-clark/mixedup.svg?branch=master)](https://travis-ci.org/m-clark/mixedup)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/m-clark/mixedup?branch=master&svg=true)](https://ci.appveyor.com/project/m-clark/mixedup)
[![Codecov test coverage](https://codecov.io/gh/m-clark/mixedup/branch/master/graph/badge.svg)](https://codecov.io/gh/m-clark/mixedup?branch=master)
<!-- badges: end -->

This package provides extended functionality for mixed models. The goal of `mixedup` is to solve little problems that slip through the cracks from the various packages, broom, and others in trying to get presentable output.  Basically the idea is to create (tidy) objects that are easy to use and essentially ready for presentation, as well as consistent across packages and across functions.  I use several of these packages (including mgcv) for mixed models, and typically have to some notable post processing to get some basic output even with broom* tidy tools, often which isn't applicable if I switch to another package.  These functions attempt to fill my specific niche.

An additional perk is minimal dependency.  Other than the package that created the object, nothing except the tidyverse is needed (presently just `dplyr`, `tidyr`, and `purrr`).

## Installation

You can install mixedup from GitHub with `devtools`:

``` r
devtools::install_github('m-clark/mixedup')
```

## Feature list

##### Extract Variance Components

- [X] lme4
- [X] glmmTMB
- [X] nlme
- [X] brms

##### Extract Random Effects

- [X] lme4
- [X] glmmTMB
- [X] nlme
- [X] brms

##### Extract Fixed Effects

- [X] lme4
- [X] glmmTMB
- [X] nlme
- [X] brms

##### Extract Random Coefficients

- [X] lme4
- [X] glmmTMB
- [X] nlme
- [X] brms

##### Extract Heterogeneous Variances

- [ ] glmmTMB
- [X] nlme

##### Find Typical

- [X] lme4
- [X] glmmTMB
- [X] nlme
- [X] brms


Just a note, <span class="pack" style = "">nlme</span> has pretty much been superseded by <span class="pack" style = "">glmmTMB</span>, <span class="pack" style = "">brms</span>, and others, so support here is pretty minimal.

## Examples

### Setup

```{r mods}
library(lme4)

lmer_1 <- lmer(Reaction ~ Days + (1 | Subject), data = sleepstudy)

lmer_2 <- lmer(Reaction ~ Days + (1 + Days| Subject), data = sleepstudy)

library(glmmTMB)

tmb_1 <- glmmTMB(Reaction ~ Days + (1 | Subject), data = sleepstudy)

tmb_2 <- glmmTMB(Reaction ~ Days + (1 + Days | Subject), data = sleepstudy)

library(nlme)

nlme_1 <-  nlme(
  height ~ SSasymp(age, Asym, R0, lrc),
  data = Loblolly,
  fixed = Asym + R0 + lrc ~ 1,
  random = Asym ~ 1,
  start = c(Asym = 103, R0 = -8.5, lrc = -3.3)
)

library(brms)

brm_1 = brm(
  Reaction ~ Days + (1 + Days| Subject), 
  data = sleepstudy, 
  refresh = -1,
  cores = 4
)
```


### Extract Random Effects

Extract the random effects with their (not necessarily valid) standard errors from model objects.

```{r extract-re}
library(mixedup)

extract_random_effects(lmer_1)

extract_random_effects(brm_1, ci_level = .8)
```
### Extract Fixed Effects


```{r fe}
extract_fixed_effects(brm_1)


extract_fixed_effects(nlme_1)
```


### Extract Random Coefficients

Extract the random coefficients with their standard errors (if available).


```{r coefs}
extract_random_coefs(lmer_1)


extract_random_coefs(tmb_2)
```


### Extract Variance Components

```{r vc}
extract_vc(lmer_2)


extract_vc(lmer_2, ci_scale = 'var', show_cor = TRUE, digits = 2)


extract_vc(nlme_1)


extract_vc(brm_1)
```


### Extract Heterogeneous Variances

Extract heterogeneous variances from nlme (and eventually others), which only reports the relative standard deviation values by default.

```{r hetvar-nlme}
library(nlme)

model <- lme(
  distance ~ age + Sex, 
  data = Orthodont, 
  random = ~ 1|Subject,
  weights = varIdent(form = ~ 1 | Sex)
)

summary(model)

extract_het_var(model)
```

### Find typical values

```{r find-typical}
find_typical(lmer_1)

find_typical(tmb_2, probs = c(.25, .5, .75))
```


## Other stuff

### Code of Conduct

Please note that the 'mixedup' project is released with a [Contributor Code of Conduct](.github/CODE_OF_CONDUCT.md).

By contributing to this project, you agree to abide by its terms.

